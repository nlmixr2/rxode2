<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rxode2">
<title>Plotting rxode2 models • rxode2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plotting rxode2 models">
<meta property="og:description" content="rxode2">
<meta property="og:image" content="https://nlmixr2.github.io/rxode2/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rxode2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.11.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--articles">
    <span class="fas fa fas fa-book"></span>
     
    Articles
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/rxode2-syntax.html">rxode2 mini language syntax</a>
    <a class="dropdown-item" href="../articles/rxode2-pipeline.html">rxode2 with piping ie %&gt;%</a>
    <a class="dropdown-item" href="../articles/rxode2-speed.html">Speeding up rxode2 ODE solving</a>
    <a class="dropdown-item" href="../articles/rxode2-data-frame.html">Adaptive Data Frames with rxode2</a>
    <a class="dropdown-item" href="../articles/rxode2-plot.html">Plotting with rxode2</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced Features, Model Types, Technical Details</h6>
    <a class="dropdown-item" href="../articles/rxode2-model-types.html">rxode2 model types</a>
    <a class="dropdown-item" href="../articles/rxode2-cmt.html">Chainging rxode2 compartment numbers</a>
    <a class="dropdown-item" href="../articles/rxode2-transit-compartments.html">rxode2 transit compartment models</a>
    <a class="dropdown-item" href="../articles/rxode2-shiny.html">Using Shiny with rxode2</a>
    <a class="dropdown-item" href="../articles/rxode2-covariates.html">rxode2 covariates</a>
    <a class="dropdown-item" href="../articles/rxode2-stiff.html">Stiff Systems and Jacobian specification</a>
    <a class="dropdown-item" href="../articles/rxode2-rxUse.html">Adding compiled rxode2 models to your package</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--dosing-events">
    <span class="fas fa fas fa-stethoscope"></span>
     
    Dosing/Events
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--dosing-events">
    <a class="dropdown-item" href="../articles/rxode2-datasets.html">nlmixr/rxode2 dataset overview</a>
    <a class="dropdown-item" href="../articles/rxode2-event-types.html">Supported Event Types</a>
    <a class="dropdown-item" href="../articles/rxode2-event-table.html">Easy rxode2 Event Tables</a>
    <a class="dropdown-item" href="../articles/rxode2-events-classic.html">Classic rxode2 events explained</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--simulations">
    <span class="fas fa fas fa-desktop"></span>
     
    Simulations
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--simulations">
    <a class="dropdown-item" href="../articles/rxode2-single-subject.html">Single Subject ODE solving</a>
    <a class="dropdown-item" href="../articles/rxode2-sim-var.html">Multiple Subject rxode2 Simulation</a>
    <a class="dropdown-item" href="../articles/rxode2-prior-data.html">Using Prior Data for ODE solving</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--help">
    <span class="fas fa fas fa-life-ring"></span>
     
    Help
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--help">
    <a class="dropdown-item" href="../articles/rxode2-tutorials.html">Running the interactive tutorials</a>
    <a class="external-link dropdown-item" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4728294/pdf/PSP4-5-03.pdf">2015 CPT tutorial</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/rxode2-covariates.html">Adding Circadian Rythmn (time-varying covariates)</a>
    <a class="dropdown-item" href="../articles/rxode2-wt.html">Weight Based Dosing</a>
    <a class="dropdown-item" href="../articles/rxode2-nesting.html">Simulating Multiple levels of nesting (iov, between study etc)</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changes/News</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://nlmixr2.github.io/rxode2/reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--">
    <span class="fas fa fas fa-archive"></span>
     
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--">
    <a class="dropdown-item" href="https://nlmixr2.github.io/rxode2-manual/">rxode2 User Guide</a>
    <a class="external-link dropdown-item" href="https://nlmixr2.org/">nlmixr2</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/rxode2">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/rxode2/releases">
    <span class="fa fa-download"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Plotting rxode2 models</h1>
                        <h4 data-toc-skip class="author">Matthew
Fidler</h4>
            
            <h4 data-toc-skip class="date">2022-11-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/rxode2/blob/HEAD/vignettes/rxode2-plot.Rmd" class="external-link"><code>vignettes/rxode2-plot.Rmd</code></a></small>
      <div class="d-none name"><code>rxode2-plot.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="plotting-in-rxode2">Plotting in rxode2<a class="anchor" aria-label="anchor" href="#plotting-in-rxode2"></a>
</h2>
<div class="section level3">
<h3 id="setting-up-model-for-plotting-explanation">Setting up model for plotting explanation<a class="anchor" aria-label="anchor" href="#setting-up-model-for-plotting-explanation"></a>
</h3>
<p>The first step to explain the rxode2 model plots is to setup:</p>
<ol style="list-style-type: decimal">
<li>An rxode2 model</li>
<li>An event table</li>
<li>A solved object</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/">rxode2</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## rxode2 2.0.11.9000 using 1 threads (see ?getRxThreads)</span></span>
<span><span class="co">##   no cache: create with `rxCreateCache()`</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Model from rxode2 tutorial</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxode2.html">rxode2</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">KA</span> <span class="op">&lt;-</span> <span class="fl">2.94E-01</span></span>
<span>  <span class="va">CL</span> <span class="op">&lt;-</span> <span class="fl">1.86E+01</span></span>
<span>  <span class="va">V2</span> <span class="op">&lt;-</span> <span class="fl">4.02E+01</span></span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fl">1.05E+01</span></span>
<span>  <span class="va">V3</span> <span class="op">&lt;-</span> <span class="fl">2.97E+02</span></span>
<span>  <span class="va">Kin</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">Kout</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">EC50</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span>  <span class="co">## Added modeled bioavaiblity, duration and rate</span></span>
<span>  <span class="va">fdepot</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">durDepot</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span>  <span class="va">rateDepot</span> <span class="op">&lt;-</span> <span class="fl">1250</span></span>
<span>  <span class="va">C2</span> <span class="op">&lt;-</span> <span class="va">centr</span> <span class="op">/</span> <span class="va">V2</span></span>
<span>  <span class="va">C3</span> <span class="op">&lt;-</span> <span class="va">peri</span> <span class="op">/</span> <span class="va">V3</span></span>
<span>  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">KA</span> <span class="op">*</span> <span class="va">depot</span></span>
<span>  <span class="fu">f</span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fdepot</span></span>
<span>  <span class="fu">dur</span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">durDepot</span></span>
<span>  <span class="fu">rate</span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rateDepot</span></span>
<span>  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">centr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">KA</span> <span class="op">*</span> <span class="va">depot</span> <span class="op">-</span> <span class="va">CL</span> <span class="op">*</span> <span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C2</span> <span class="op">+</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C3</span></span>
<span>  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">peri</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C3</span></span>
<span>  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">eff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Kin</span> <span class="op">-</span> <span class="va">Kout</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">C2</span> <span class="op">/</span> <span class="op">(</span><span class="va">EC50</span> <span class="op">+</span> <span class="va">C2</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">eff</span></span>
<span>  <span class="fu">eff</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>timeUnits <span class="op">=</span> <span class="st">"hr"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">10000</span>, ii <span class="op">=</span> <span class="fl">12</span>, until <span class="op">=</span> <span class="fl">24</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">ev</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="default-rxode2-plot">Default rxode2 plot<a class="anchor" aria-label="anchor" href="#default-rxode2-plot"></a>
</h3>
<p>The default plot in <code>rxode2</code> is to plot time versus
<code>state</code> or calculated <code>lhs</code> values:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-plot_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Things to note:</p>
<p>First, these plots are actually <code>ggplot2</code> plots and can be
modified by the standard <code>ggplot2</code> grammar of graphics</p>
<p>Also note that the <code>plot</code> method for <code>rxSolve</code>
objects can currently use some of the arguments of the default plot
method:</p>
<ul>
<li><p><code>log</code> a character string which contains
<code>"x"</code> if the x axis is to be logarithmic, <code>"y"</code> if
the y axis is to be logarithmic and <code>"xy"</code> or
<code>"yx"</code> if both axes are to be logarithmic. If available, this
will use the <code>xgxr</code> <code><a href="https://rdrr.io/pkg/xgxr/man/xgx_scale_x_log10.html" class="external-link">xgx_scale_x_log10()</a></code> and
<code><a href="https://rdrr.io/pkg/xgxr/man/xgx_scale_y_log10.html" class="external-link">xgx_scale_y_log10()</a></code> functions.</p></li>
<li><p><code>xlab</code> This is a bit different than simply supplying
the x-label through <code>ggplot2</code>, it will retain the unit
information originally supplied in the event table. Also note, if
available, this unit information is used will be used to have more
meaningful ticks with <code><a href="https://rdrr.io/pkg/xgxr/man/xgx_scale_x_time_units.html" class="external-link">xgx_scale_x_time_units()</a></code></p></li>
<li><p><code>ylab</code> This supplies the y label</p></li>
</ul>
<p>The following are currently unsupported: a. <code>type</code> b.
<code>xlim</code> c. <code>ylim</code> d. <code>main</code> e.
<code>sub</code> f. <code>ann</code> g. <code>axes</code></p>
</div>
</div>
<div class="section level2">
<h2 id="subsetting-plots">Subsetting plots<a class="anchor" aria-label="anchor" href="#subsetting-plots"></a>
</h2>
<p>While this is very interesting, it is often more useful to subset
plots based on values you are more interested in; For example, it is
more interesting in this plot to <code>eff</code> and <code>C2</code>.
To do this, you simply specify the interesting items after the plot
function. For instance:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">C2</span>, <span class="va">eff</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-plot_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="semi-log-plots">Semi-log plots<a class="anchor" aria-label="anchor" href="#semi-log-plots"></a>
</h2>
<p>Semi-log plots of PK concentrations are very common; To do this you
simply need to use <code>log="y"</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">C2</span>, log<span class="op">=</span><span class="st">"y"</span>, ylab<span class="op">=</span><span class="st">"Concentration"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></span></code></pre>
<p><img src="rxode2-plot_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>This uses the <code><a href="https://rdrr.io/pkg/xgxr/man/xgx_scale_y_log10.html" class="external-link">xgx_scale_y_log10()</a></code> when available to more
clearly show the semi-log nature of the plot.</p>
</div>
<div class="section level2">
<h2 id="plots-with-multi-subject-plots">Plots with multi-subject plots<a class="anchor" aria-label="anchor" href="#plots-with-multi-subject-plots"></a>
</h2>
<p>If you have multi-subject plots you can easily plot applying the same
principles as above. To illustrate this plot, lets expand an event table
to include a plot of 4 subjects with lognormal random variability
between subjects;</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setup the new problem</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxode2.html">rxode2</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">KA</span> <span class="op">&lt;-</span> <span class="fl">2.94E-01</span></span>
<span>  <span class="va">CL</span> <span class="op">&lt;-</span> <span class="fl">1.86E+01</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.Cl</span><span class="op">)</span></span>
<span>  <span class="va">V2</span> <span class="op">&lt;-</span> <span class="fl">4.02E+01</span></span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fl">1.05E+01</span></span>
<span>  <span class="va">V3</span> <span class="op">&lt;-</span> <span class="fl">2.97E+02</span></span>
<span>  <span class="va">Kin</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">Kout</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">EC50</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span>  <span class="co">## Added modeled bioavaiblity, duration and rate</span></span>
<span>  <span class="va">fdepot</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">durDepot</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span>  <span class="va">rateDepot</span> <span class="op">&lt;-</span> <span class="fl">1250</span></span>
<span>  <span class="va">C2</span> <span class="op">&lt;-</span> <span class="va">centr</span> <span class="op">/</span> <span class="va">V2</span></span>
<span>  <span class="va">C3</span> <span class="op">&lt;-</span> <span class="va">peri</span> <span class="op">/</span> <span class="va">V3</span></span>
<span>  <span class="va">d</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">KA</span> <span class="op">*</span> <span class="va">depot</span></span>
<span>  <span class="fu">f</span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fdepot</span></span>
<span>  <span class="fu">dur</span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">durDepot</span></span>
<span>  <span class="fu">rate</span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rateDepot</span></span>
<span>  <span class="va">d</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">centr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">KA</span> <span class="op">*</span> <span class="va">depot</span> <span class="op">-</span> <span class="va">CL</span> <span class="op">*</span> <span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C2</span> <span class="op">+</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C3</span></span>
<span>  <span class="va">d</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">peri</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span> <span class="op">*</span> <span class="va">C3</span></span>
<span>  <span class="va">d</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">eff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Kin</span> <span class="op">-</span> <span class="va">Kout</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">C2</span> <span class="op">/</span> <span class="op">(</span><span class="va">EC50</span> <span class="op">+</span> <span class="va">C2</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">eff</span></span>
<span>  <span class="fu">eff</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the between subject variability:</span></span>
<span><span class="va">omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lotri/man/lotri.html" class="external-link">lotri</a></span><span class="op">(</span><span class="va">eta.Cl</span> <span class="op">~</span> <span class="fl">0.4</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the event table</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>timeUnits <span class="op">=</span> <span class="st">"hr"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">10000</span>, until <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">days</span><span class="op">)</span>, ii <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># loading doses</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">m2</span>, <span class="va">ev</span>, omega<span class="op">=</span><span class="va">omega</span><span class="op">)</span></span></code></pre></div>
<p>Once that is complete, you may plot it by the same method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">C2</span>, <span class="va">eff</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-plot_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Notice that this is colored by each individual and labeled with a
legend.</p>
<p>If you are only interested in the concentration, it produces a
similar plot:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">C2</span>, log<span class="op">=</span><span class="st">"y"</span>, ylab<span class="op">=</span><span class="st">"Concentration"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></span></code></pre>
<p><img src="rxode2-plot_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Notice that this plot each individual is labeled by an attached id to
let you know where the individual comes from. This is done by
<code>ggrepel</code> if it is available, otherwise a legend is
retained.</p>
<div class="section level3">
<h3 id="multi-subject-plots-with-large-number-of-subjects">Multi-subject plots with large number of subjects<a class="anchor" aria-label="anchor" href="#multi-subject-plots-with-large-number-of-subjects"></a>
</h3>
<p>This can get a bit much when there are many subjects that are solved
(in this example lets simulate 100)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>timeUnits <span class="op">=</span> <span class="st">"hr"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">10000</span>, until <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">days</span><span class="op">)</span>, ii <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># loading doses</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="co"># 100 subjects</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">m2</span>, <span class="va">ev</span>, omega<span class="op">=</span><span class="va">omega</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">C2</span>, log<span class="op">=</span><span class="st">"y"</span>, ylab<span class="op">=</span><span class="st">"Concentration"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></span></code></pre>
<p><img src="rxode2-plot_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>In this case, all the individuals are put on the plot in transparent
grayscale and plot on the same pane. This allows the places where more
subjects are present to be darker.</p>
<p>The number of individuals where the plots switch from legend to
grayscale is controlled by changing the options for
<code>rxode2.spaghetti</code>. ie.
<code>options(rxode2.spaghetti=7)</code>. 7 individuals is the default
value when the plotting changes from individual to grayscale spaghetti
plots.</p>
<p>You can also create a confidence interval of these simulations with
<code>confint</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">s</span>, parm<span class="op">=</span><span class="st">"C2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BBBB00;">!</span> in order to put confidence bands around the intervals, you need at least 2500 simulations</span></span></code></pre>
<pre><code><span><span class="co">## summarizing data...done</span></span></code></pre>
<p>And plot this with <code>plot</code></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-plot_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew L. Fidler, Melissa Hallow, Wenping Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
